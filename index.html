<html>
  <head>
    <meta content="text/html;charset=utf-8" http-equiv="Content-Type"/>
  </head>
  <body>
    <script type="module">
      import init, { SegmentBuilder, Segment, SearchIndex, set_panic_hook } from './pkg/test_tantivy.js';

      async function run() {
        
        // modes
        await init();
        set_panic_hook();
        // And afterwards we can use all the functionality defined in wasm.

        const schema = {
          body: { text: true },
          title: { stored: true, text: true },
        };

        const segmentBuilder = new SegmentBuilder(schema, 50_000_000); 


        segmentBuilder.addDocument({
          title: "Lord Of The Rings",
          body: "And some things that should not have been forgotten were lost. History became legend. Legend became myth. And for two and a half thousand years, the ring passed out of all knowledge.",
        });

        segmentBuilder.addDocument({
          title:  "The Old Man and the Sea",
          body: `He was an old man who fished alone in a skiff in the Gulf Stream and 
          he had gone eighty-four days now without taking a fish.`,
        });
        segmentBuilder.addDocument({
          title: "Of Mice and Men",
          body:  `A few miles south of Soledad, the Salinas River drops in close to the hillside 
          bank and runs deep and green. The water is warm too, for it has slipped twinkling 
          over the yellow sands in the sunlight before reaching the narrow pool. On one 
          side of the river the golden foothill slopes curve up to the strong and rocky 
          Gabilan Mountains, but on the valley side the water is lined with trees—willows 
          fresh and green with every spring, carrying in their lower leaf junctures the 
          debris of the winter’s flooding; and sycamores with mottled, white, recumbent 
          limbs and branches that arch over the pool`,
        });
        segmentBuilder.addDocument({
          title: "Frankenstein",
          // title: "The Modern Prometheus", TODO: on ne supporte plus ce cas là
          body: `You will rejoice to hear that no disaster has accompanied the commencement of an 
          enterprise which you have regarded with such evil forebodings.  I arrived here 
          yesterday, and my first task is to assure my dear sister of my welfare and 
          increasing confidence in the success of my undertaking.`,
          
        });
        
        segmentBuilder.addDocument({
          title: "Le seigneur des anneaux",
          body: "C'est une étrange fatalité que nous devions éprouver tant de peurs et de doutes, pour une si petite chose.",
        });
        
        let segment = segmentBuilder.finalize();


        const segmentBuilder2 = new SegmentBuilder(schema, 50_000_000); 

        segmentBuilder2.addDocument({
          title: "Lord of the Rings",
          body: `Home is behind, the world ahead,
          and there are many paths to tread
          through shadows to the edge of night,
          until the stars are all alight`,
          
        });

        let segment2 = segmentBuilder2.finalize();

        const searchIndex = new SearchIndex();
        console.error("EMPTY")
        searchIndex.directorySummary();
        searchIndex.registerSegment(segment);
        console.error("FIRST")
        searchIndex.directorySummary();
        searchIndex.registerSegment(segment2);
        console.error("SECOND")
        searchIndex.directorySummary();
        let results = searchIndex.search('the', {fields: ['title'], limit: 10});
        console.log(results)
      }

      run();
    </script>
  </body>
</html>